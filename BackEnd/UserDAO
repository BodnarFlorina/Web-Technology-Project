<?php
require_once '../BackEnd/Database/DatabaseHandler.php';  

class UserDAO
{
    private $db;

    public function __construct()
    {
        $this->db = DatabaseConnection::getInstance()->getConnection();
    }

   public function createUser(User $user)
    {
    $email = $user->getEmail();
    $username = $user->getUsername();
    $password = $user->getPassword();
    $hashedPassword = password_hash($password, PASSWORD_DEFAULT);

    $stmt = $this->db->prepare("INSERT INTO users (email, username, password_hash) VALUES (?, ?, ?)");
    $success = $stmt->execute([$email, $username, $hashedPassword]);

    return $success;
    }


    public function checkExistingUser($email, $username)
    {
        $stmt = $this->db->prepare("SELECT * FROM users WHERE email = ? OR username = ?");
        $stmt->execute([$email, $username]);

        return $stmt->fetch() !== false;
    }

    public function checkLogin($username, $password) {
        $stmt = $this->db->prepare("SELECT * FROM users WHERE username = ?");
        $stmt->execute([$username]);

        $user = $stmt->fetch();

        if ($user && password_verify($password, $user['password_hash'])) {
            // Parola este corectă
            return true;
        } else {
            // Autentificare eșuată
            return false;
        }
    }

}
?>
